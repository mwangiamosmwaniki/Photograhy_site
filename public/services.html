<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <title>Photography Services & Pricing | Jr Photography</title>
    <meta
      name="description"
      content="Explore professional photography services and pricing from Jr Photography. Wedding, portrait, event, and commercial packages tailored to your needs."
    />

    <link rel="stylesheet" href="css/styles.css" />
    <link rel="icon" type="image/webp" href="/images/icon.webp" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>

  <body>
    <header>
      <a href="index.html" class="logo">
        <img src="images/icon.webp" alt="JR Pixels Logo" />
      </a>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </button>

      <nav class="nav-menu" id="nav-menu">
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="portfolio.html">Portfolio</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li>
            <a
              href="booking.html"
              class="inline-block border-2 border-yellow-500 !text-yellow-500 font-semibold rounded-lg !px-4 !py-2 hover:!bg-yellow-500 hover:!text-white transition-colors duration-300"
            >
              Book Now
            </a>
          </li>
        </ul>
      </nav>
    </header>

    <main class="bg-gray-100">
      <section id="pricing">
        <h1 style="text-align: center">Photography Packages</h1>
        <p style="text-align: center; max-width: 800px; margin: 0 auto 50px">
          From quick headshots to full-day wedding coverage, find the perfect
          fit for your needs. All packages include high-resolution digital
          files.
        </p>

        <!-- Loading Indicator -->
        <div
          id="loading"
          style="display: block; text-align: center; padding: 40px; color: #666"
        >
          <div
            style="
              display: inline-block;
              position: relative;
              width: 80px;
              height: 80px;
            "
          >
            <div
              style="
                position: absolute;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #3498db;
                border-radius: 50%;
                width: 60px;
                height: 60px;
                animation: spin 1s linear infinite;
                top: 10px;
                left: 10px;
              "
            ></div>
          </div>
          <p style="margin-top: 20px; font-size: 1.1rem">Loading packages...</p>
        </div>

        <div class="pricing-grid" id="pricingGrid" style="display: none">
          <!-- Pricing cards will be inserted here dynamically -->
        </div>

        <div
          id="error"
          style="
            display: none;
            text-align: center;
            padding: 40px;
            color: #e74c3c;
          "
        >
          <p style="font-size: 1.2rem; margin-bottom: 1rem">
            Unable to load pricing packages.
          </p>
          <p
            id="errorMessage"
            style="font-size: 0.9rem; color: #666; margin-bottom: 1rem"
          ></p>
          <button
            onclick="location.reload()"
            style="
              padding: 0.75rem 1.5rem;
              background: #3498db;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 1rem;
              font-weight: 600;
            "
            onmouseover="this.style.background='#2980b9'"
            onmouseout="this.style.background='#3498db'"
          >
            ðŸ”„ Retry
          </button>
        </div>

        <p style="text-align: center; margin-top: 50px">
          *For custom wedding or commercial quotes, please use the
          <a
            href="contact.html"
            style="color: var(--accent-color); text-decoration: underline"
            >contact form</a
          >.
        </p>
      </section>
    </main>

    <footer>
      <p>
        &copy; <span id="currentYear">2025</span> Jr Photography. All rights
        reserved.
      </p>
    </footer>

    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      // --- API Configuration ---
      const SERVICES_CONFIG = {
        development: {
          apiUrl: "http://localhost:3000",
        },
        production: {
          apiUrl: "https://photography-site-8pct.onrender.com",
        },
      };

      const isDevelopment =
        window.location.hostname === "localhost" ||
        window.location.hostname === "127.0.0.1";

      const API_BASE_URL = isDevelopment
        ? SERVICES_CONFIG.development.apiUrl
        : SERVICES_CONFIG.production.apiUrl;

      console.log("ðŸ’¼ Services API URL:", API_BASE_URL);
      console.log("ðŸŒ Current hostname:", window.location.hostname);
      console.log("ðŸ”§ Development mode:", isDevelopment);

      // Fetch pricing packages from MongoDB via Node backend
      async function loadPricingPackages() {
        const loadingEl = document.getElementById("loading");
        const gridEl = document.getElementById("pricingGrid");
        const errorEl = document.getElementById("error");
        const errorMessageEl = document.getElementById("errorMessage");

        const packagesEndpoint = `${API_BASE_URL}/api/packages`;
        console.log("ðŸ“¡ Fetching packages from:", packagesEndpoint);

        try {
          // Fetch packages from your backend API
          const response = await fetch(packagesEndpoint);

          console.log("ðŸ“Š Response status:", response.status);
          console.log("ðŸ“Š Response ok:", response.ok);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const packages = await response.json();
          console.log("ðŸ“¦ Packages received:", packages.length);

          if (packages.length > 0) {
            console.log("ðŸ“¦ Sample package:", packages[0]);
          }

          // Hide loading, show grid
          loadingEl.style.display = "none";

          if (packages.length === 0) {
            gridEl.innerHTML = `
              <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">
                <p style="font-size: 1.2rem; margin-bottom: 1rem;">No packages available yet.</p>
                <p style="font-size: 0.9rem;">Please check back soon or contact us for custom pricing!</p>
              </div>
            `;
            gridEl.style.display = "grid";
            return;
          }

          gridEl.style.display = "grid";

          // Clear any existing content
          gridEl.innerHTML = "";

          // Render each package
          packages.forEach((pkg, index) => {
            console.log(`ðŸ’³ Creating card ${index + 1}:`, pkg.name);
            const card = createPricingCard(pkg);
            gridEl.appendChild(card);
          });

          console.log("âœ… Packages loaded successfully!");
        } catch (error) {
          console.error("âŒ Error loading packages:", error);
          console.error("âŒ Error details:", {
            message: error.message,
            stack: error.stack,
          });

          loadingEl.style.display = "none";
          errorEl.style.display = "block";
          errorMessageEl.textContent = `Error: ${error.message} | Endpoint: ${packagesEndpoint}`;
        }
      }

      // Create a pricing card element
      function createPricingCard(pkg) {
        const card = document.createElement("div");
        card.className = "pricing-card";

        // Format price with thousand separators
        const formattedPrice = pkg.price.toLocaleString("en-KE");

        // Build features list
        const featuresList = pkg.features
          .map((feature) => {
            const strikethrough = feature.strikethrough
              ? ' style="text-decoration: line-through; opacity: 0.6;"'
              : "";
            return `<li${strikethrough}>${feature.text}</li>`;
          })
          .join("");

        card.innerHTML = `
          <h3>${pkg.name}</h3>
          <p class="price">Ksh ${formattedPrice}</p>
          <p>${pkg.description}</p>
          <ul class="features">
            ${featuresList}
          </ul>
          <a href="booking.html?package=${encodeURIComponent(
            pkg.name
          )}" class="btn">Book Now</a>
        `;

        return card;
      }

      // Load packages when page loads
      document.addEventListener("DOMContentLoaded", () => {
        loadPricingPackages();

        // Set current year in footer
        const currentYearSpan = document.getElementById("currentYear");
        if (currentYearSpan) {
          currentYearSpan.textContent = new Date().getFullYear();
        }
      });
    </script>
    <script src="js/script.js"></script>
  </body>
</html>
