<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Services & Pricing</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <header>
      <a href="index.html" class="logo">Lens & Light</a>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="portfolio.html">Portfolio</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="booking.html" class="btn secondary">Book Now</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="pricing">
        <h1 style="text-align: center">Photography Packages</h1>
        <p style="text-align: center; max-width: 800px; margin: 0 auto 50px">
          From quick headshots to full-day wedding coverage, find the perfect
          fit for your needs. All packages include high-resolution digital
          files.
        </p>

        <div id="loading" style="text-align: center; padding: 40px">
          <p>Loading packages...</p>
        </div>

        <div class="pricing-grid" id="pricingGrid" style="display: none">
          <!-- Pricing cards will be inserted here dynamically -->
        </div>

        <div
          id="error"
          style="
            display: none;
            text-align: center;
            padding: 40px;
            color: #e74c3c;
          "
        >
          <p>Unable to load pricing packages. Please try again later.</p>
        </div>

        <p style="text-align: center; margin-top: 50px">
          *For custom wedding or commercial quotes, please use the
          <a href="contact.html">contact form</a>.
        </p>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 Jr Photography. All rights reserved.</p>
    </footer>

    <script>
      // Fetch pricing packages from MongoDB via Node backend
      async function loadPricingPackages() {
        const loadingEl = document.getElementById("loading");
        const gridEl = document.getElementById("pricingGrid");
        const errorEl = document.getElementById("error");

        try {
          // Fetch packages from your backend API
          const response = await fetch("/api/packages");

          if (!response.ok) {
            throw new Error("Failed to fetch packages");
          }

          const packages = await response.json();

          // Hide loading, show grid
          loadingEl.style.display = "none";
          gridEl.style.display = "grid";

          // Clear any existing content
          gridEl.innerHTML = "";

          // Render each package
          packages.forEach((pkg) => {
            const card = createPricingCard(pkg);
            gridEl.appendChild(card);
          });
        } catch (error) {
          console.error("Error loading packages:", error);
          loadingEl.style.display = "none";
          errorEl.style.display = "block";
        }
      }

      // Create a pricing card element
      function createPricingCard(pkg) {
        const card = document.createElement("div");
        card.className = "pricing-card";

        // Format price with thousand separators
        const formattedPrice = pkg.price.toLocaleString("en-KE");

        // Build features list
        const featuresList = pkg.features
          .map((feature) => {
            const strikethrough = feature.strikethrough
              ? ' style="text-decoration: line-through"'
              : "";
            return `<li${strikethrough}>${feature.text}</li>`;
          })
          .join("");

        card.innerHTML = `
          <h3>${pkg.name}</h3>
          <p class="price">Ksh ${formattedPrice}</p>
          <p>${pkg.description}</p>
          <ul class="features">
            ${featuresList}
          </ul>
          <a href="booking.html?package=${encodeURIComponent(
            pkg.name
          )}" class="btn">Book Now</a>
        `;

        return card;
      }

      // Load packages when page loads
      document.addEventListener("DOMContentLoaded", loadPricingPackages);
    </script>
    <script src="js/script.js"></script>
  </body>
</html>
